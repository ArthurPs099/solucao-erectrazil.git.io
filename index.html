<!-- TIMER TOPO -->
<div class="promo pulse" id="promoTop">
  PROMOÇÃO RELÂMPAGO · 10% DE DESCONTO
  <span id="timerTop">10:00</span>
</div>

<!-- TIMER PLANOS -->
<div class="big-timer">
  <h3 id="bigTimerCopy">Oferta especial disponível por</h3>
  <span id="timerPlans">10:00</span>
</div>

<audio id="tickSound" preload="auto"><source src="tick.mp3" type="audio/mpeg"></audio>

<script>
/* SCROLL ANIMATION */
const sections = document.querySelectorAll('.section');
const obs = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if(entry.isIntersecting) entry.target.classList.add('visible');
  });
}, { threshold: 0.25 });
sections.forEach(s => obs.observe(s));

/* TIMERS SINCRONIZADOS COM COOLDOWN */
const tTop = document.getElementById('timerTop');
const tPlan = document.getElementById('timerPlans');
const promo = document.getElementById('promoTop');
const bigCopy = document.getElementById('bigTimerCopy');
const tick = document.getElementById('tickSound');

const PROMO_DURATION = 10 * 60 * 1000; // 10 minutos
const COOLDOWN_DURATION = 12 * 60 * 60 * 1000; // 12 horas

function startTimer(duration, isPromo) {
  let endTime = Date.now() + duration;
  const timerInterval = setInterval(() => {
    const remaining = endTime - Date.now();
    if(remaining <= 0){
      clearInterval(timerInterval);
      if(isPromo){
        // Inicia cooldown
        promo.innerHTML = 'PROMOÇÃO ENCERRADA';
        bigCopy.innerText = 'Nova promoção em breve';
        startTimer(COOLDOWN_DURATION, false);
      } else {
        // Reinicia promoção após cooldown
        promo.innerHTML = 'NOVA PROMOÇÃO · 10% DE DESCONTO';
        bigCopy.innerText = 'Oferta especial disponível por';
        startTimer(PROMO_DURATION, true);
      }
      return;
    }

    const minutes = Math.floor(remaining / 60000);
    const seconds = Math.floor((remaining % 60000) / 1000).toString().padStart(2,'0');
    tTop.textContent = `${minutes}:${seconds}`;
    tPlan.textContent = `${minutes}:${seconds}`;

    tick.volume = 0.12;
    tick.currentTime = 0;
    tick.play().catch(()=>{});
  }, 1000);
}

// Verifica se já existe promoção ativa ou cooldown no localStorage
let promoEnd = localStorage.getItem('promoEnd');
let isPromo = localStorage.getItem('isPromo');

if(promoEnd && isPromo){
  promoEnd = parseInt(promoEnd);
  const remaining = promoEnd - Date.now();
  if(remaining > 0){
    startTimer(remaining, isPromo === 'true');
  } else {
    // Se expirou, inicia cooldown ou nova promoção
    startTimer(isPromo === 'true' ? COOLDOWN_DURATION : PROMO_DURATION, isPromo !== 'true');
  }
} else {
  // Inicia promoção padrão
  startTimer(PROMO_DURATION, true);
}

// Atualiza localStorage a cada segundo
setInterval(()=>{
  const currentIsPromo = promo.innerHTML.includes('DESCONTO');
  const currentEnd = Date.now() + ((currentIsPromo) ? PROMO_DURATION : COOLDOWN_DURATION);
  localStorage.setItem('promoEnd', currentEnd);
  localStorage.setItem('isPromo', currentIsPromo);
},1000);
</script>
